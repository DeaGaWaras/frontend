<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - SMAN1KE</title>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../assets/css/styles.css" />
  </head>

  <body
    class="min-h-screen bg-gradient-to-br from-pink-50 via-white to-purple-50 flex items-center justify-center px-4 py-8"
  >
    <div
      id="notify-wrapper"
      class="fixed top-4 right-4 z-[9999] space-y-3"
    ></div>

    <!-- Wrapper dibuat sedikit lebih sempit & responsif -->
    <div class="w-full max-w-[380px] sm:max-w-md">
      <div class="card-modern p-6 sm:p-8 rounded-2xl shadow-xl">
        <!-- Header -->
        <div class="text-center mb-7 sm:mb-8">
          <div
            class="gradient-header w-14 h-14 sm:w-16 sm:h-16 rounded-full flex items-center justify-center text-white text-2xl sm:text-3xl mx-auto mb-4"
          >
            <i class="fas fa-lock"></i>
          </div>

          <h1
            class="text-xl sm:text-3xl font-extrabold text-gradient-pink mb-1 sm:mb-2"
          >
            Masuk Akun
          </h1>

          <p class="text-gray-600 text-[11px] sm:text-sm leading-relaxed">
            Sistem Manajemen Absensi SMAN 1 Kedunggalar
          </p>
        </div>

        <!-- FORM -->
        <form id="loginForm" class="space-y-4 sm:space-y-5">
          <div class="flex items-center gap-3">
  <i class="fas fa-envelope text-pink-500 text-lg"></i>

  <input
    type="email"
    id="login-email"
    class="flex-1 w-full px-4 py-2.5 sm:py-3 bg-gray-50 rounded-lg 
           text-sm sm:text-base focus:bg-white focus:ring-2 
           focus:ring-pink-300 transition-all"
    placeholder="Email"
    required
  />
</div>


<!-- Password -->
<div class="flex items-center gap-3">
  <i class="fas fa-lock text-pink-500 text-lg"></i>

  <div class="relative flex-1">
    <input
      type="password"
      id="login-password"
      class="w-full pr-11 px-4 py-2.5 sm:py-3 bg-gray-50 rounded-lg 
             text-sm sm:text-base focus:bg-white focus:ring-2 
             focus:ring-pink-300 transition-all"
      placeholder="Password"
      required
    />

    <button
      type="button"
      id="toggle-password"
      class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 
             hover:text-gray-600 transition-colors"
    >
      <i class="fas fa-eye text-sm"></i>
    </button>
  </div>
</div>


          <!-- Error -->
          <div
            id="login-error"
            class="hidden p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-xs flex items-start gap-2"
          >
            <i class="fas fa-exclamation-circle mt-0.5"></i>
            <span id="error-text"></span>
          </div>

          <!-- Button Login -->
          <button
            type="submit"
            id="login-btn"
            class="w-full py-2.5 sm:py-3 btn-primary rounded-xl font-semibold flex items-center justify-center gap-2 text-sm sm:text-base"
          >
            <i class="fas fa-sign-in-alt"></i> Masuk
          </button>

          <!-- Divider -->
          <div class="flex items-center gap-3 my-4 sm:my-6">
            <div class="flex-1 h-px bg-gray-300"></div>
            <span class="text-xs text-gray-400">atau</span>
            <div class="flex-1 h-px bg-gray-300"></div>
          </div>

          <p class="text-center text-xs sm:text-sm text-gray-600">
            Belum punya akun?
            <a
              href="./register.html"
              class="font-semibold text-pink-600 hover:text-pink-700"
            >
              Daftar di sini
            </a>
          </p>
        </form>

        <div class="mt-6 pt-5 border-t border-gray-200 text-center">
          <p class="text-[10px] sm:text-xs text-gray-500">
            ðŸ”’ Login Anda dilindungi dengan enkripsi SSL
          </p>
        </div>
      </div>
    </div>

    <script type="module">
      import { loginUser } from "../assets/js/api-consolidated.js";
      import { notify } from "../assets/js/auth-consolidated.js";

      const form = document.getElementById("loginForm");
      const emailInput = document.getElementById("login-email");
      const passwordInput = document.getElementById("login-password");
      const togglePasswordBtn = document.getElementById("toggle-password");
      const errorDiv = document.getElementById("login-error");
      const errorText = document.getElementById("error-text");
      const loginBtn = document.getElementById("login-btn");

      // Toggle Password Visibility
      togglePasswordBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const isPassword = passwordInput.type === "password";
        passwordInput.type = isPassword ? "text" : "password";
        const icon = togglePasswordBtn.querySelector("i");
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
      });

      // Handle Form Submission
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorDiv.classList.add("hidden");
        loginBtn.disabled = true;
        loginBtn.innerHTML = `<i class="fas fa-spinner animate-spin"></i> Memproses...`;

        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();

        if (!email || !password) {
          errorText.textContent = "Email dan password harus diisi.";
          errorDiv.classList.remove("hidden");
          loginBtn.disabled = false;
          loginBtn.innerHTML = `<i class="fas fa-sign-in-alt"></i> Masuk`;
          return;
        }

        try {
          await loginUser(email, password);
          notify("Login berhasil! Mengalihkan...", "success");
          setTimeout(() => {
            window.location.href = "./home.html";
          }, 1500);
        } catch (err) {
          errorText.textContent =
            err.message || "Terjadi kesalahan saat login.";
          errorDiv.classList.remove("hidden");
          loginBtn.disabled = false;
          loginBtn.innerHTML = `<i class="fas fa-sign-in-alt"></i> Masuk`;
        }
      });
    </script>
  </body>
</html>
