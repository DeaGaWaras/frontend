<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dzuhurKU - SMAN1KE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <link rel="icon" href="../assets/images/favicon.ico">
  </head>
  <body
    class="flex items-center justify-center min-h-screen px-3 sm:px-4 py-6 sm:py-8 bg-gradient-to-br from-pink-50 via-white to-purple-50"
  >
    <div
      id="notify-wrapper"
      class="fixed top-4 right-4 z-[9999] space-y-3"
    ></div>
    <div class="w-full max-w-md">
      <div class="mb-4 sm:mb-6">
        <a
          href="./login.html"
          class="inline-flex items-center gap-2 text-pink-600 hover:text-pink-700 font-semibold text-xs sm:text-sm transition"
          ><i class="fas fa-arrow-left"></i>
          <span class="hidden sm:inline">Kembali ke</span> Login</a
        >
      </div>
      <div class="card-modern p-6 sm:p-8 rounded-2xl shadow-xl">
        <div class="text-center mb-8">
          <div
            class="gradient-header w-16 h-16 rounded-full flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4"
          >
            <i class="fas fa-user-plus"></i>
          </div>
          <h1 class="text-2xl sm:text-3xl font-bold text-gradient-pink mb-2">
            Daftar Akun Baru
          </h1>
          <p class="text-gray-600 text-xs sm:text-sm">
            Bergabunglah dengan sistem manajemen kami
          </p>
        </div>
        <form id="registerForm" class="space-y-3 sm:space-y-4">
         <div class="flex items-center gap-3">
  <i class="fas fa-user text-pink-500 text-lg"></i>

  <input
    type="text"
    id="reg-name-input"
    name="name"
    required
    class="flex-1 w-full px-4 py-3 input-modern bg-gray-50 text-gray-900 text-sm
           focus:bg-white focus:ring-2 focus:ring-pink-300 transition-all rounded-lg"
    placeholder="Nama Lengkap"
    title="Nama Lengkap"
  />
</div>

          <div class="flex items-center gap-3">
  <i class="fas fa-envelope text-pink-500 text-lg"></i>

  <input
    type="email"
    id="reg-email-input"
    name="email"
    required
    class="flex-1 w-full px-4 py-3 input-modern bg-gray-50 text-gray-900 text-sm
           focus:bg-white focus:ring-2 focus:ring-pink-300 transition-all rounded-lg"
    placeholder="Email"
    title="Email"
  />
</div>

         <div class="flex items-center gap-3">
  <i class="fas fa-lock text-pink-500 text-lg"></i>

  <div class="relative flex-1">
    <input
      type="password"
      id="reg-pass-input"
      name="password"
      required
      class="w-full pr-12 px-4 py-3 input-modern bg-gray-50 text-gray-900 text-sm
             focus:bg-white focus:ring-2 focus:ring-pink-300 transition-all rounded-lg"
      placeholder="Password"
      title="Password"
    />

    <button
      type="button"
      id="toggle-pass-btn"
      class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 
             hover:text-gray-600 transition"
    >
      <i class="fas fa-eye text-sm"></i>
    </button>
  </div>
</div>

<p class="text-xs text-gray-500 mt-1">Minimal 6 karakter dengan huruf dan angka</p>

          <div>
            <label class="block text-xs font-semibold text-gray-700 mb-2"
              >Daftar Sebagai</label
            >
            <select
              id="reg-role-select"
              name="role"
              class="w-full px-4 py-2.5 input-modern bg-gray-50 text-gray-900 text-xs sm:text-sm focus:bg-white focus:ring-2 focus:ring-pink-300 transition-all"
              title="Pilih role"
            >
              <option value="siswi">ğŸ‘©â€ğŸ“ Siswi</option>
              <option value="guru">ğŸ‘¨â€ğŸ« Guru Pembina</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-700 mb-2"
              >Kelas (Opsional)</label
            >
            <input
              type="text"
              id="reg-kelas-input"
              name="kelas"
              class="w-full px-4 py-2.5 input-modern bg-gray-50 text-gray-900 text-sm focus:bg-white focus:ring-2 focus:ring-pink-300 transition-all placeholder-gray-400"
              placeholder="Contoh: XII-IPA-1"
              title="Kelas"
            />
          </div>
          <div
            id="reg-error-msg"
            class="hidden bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded text-xs flex items-start gap-2"
          >
            <i class="fas fa-exclamation-circle flex-shrink-0 mt-0.5"></i
            ><span id="error-text-msg"></span>
          </div>
          <button
            type="submit"
            id="register-btn-submit"
            class="w-full py-3 btn-primary font-semibold mt-6 transition hover:shadow-lg text-sm sm:text-base"
          >
            <i class="fas fa-user-check mr-2"></i> Daftar Sekarang
          </button>
          <div class="flex items-center gap-3 my-5">
            <div class="flex-1 h-px bg-gray-300"></div>
            <span class="text-xs text-gray-400">atau</span>
            <div class="flex-1 h-px bg-gray-300"></div>
          </div>
          <div class="text-center">
            <p class="text-gray-600 text-xs sm:text-sm">
              Sudah punya akun?
              <a
                href="./login.html"
                class="text-pink-600 font-semibold hover:text-pink-700 transition"
                >Masuk di sini</a
              >
            </p>
          </div>
        </form>
      </div>
    </div>

    <script type="module">
      import { registerUser } from "../assets/js/api-consolidated.js";
      import { notify } from "../assets/js/auth-consolidated.js";

      const form = document.getElementById("registerForm");
      const errEl = document.getElementById("reg-error-msg");
      const errText = document.getElementById("error-text-msg");
      const registerBtn = document.getElementById("register-btn-submit");
      const nameInput = document.getElementById("reg-name-input");
      const emailInput = document.getElementById("reg-email-input");
      const passwordInput = document.getElementById("reg-pass-input");
      const togglePasswordBtn = document.getElementById("toggle-pass-btn");
      const roleSelect = document.getElementById("reg-role-select");
      const kelasInput = document.getElementById("reg-kelas-input");

      // Toggle Password Visibility
      togglePasswordBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const isPassword = passwordInput.type === "password";
        passwordInput.type = isPassword ? "text" : "password";
        const icon = togglePasswordBtn.querySelector("i");
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
      });

      // Handle Form Submission
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = nameInput.value.trim();
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        const role = roleSelect.value;
        const kelas = kelasInput.value.trim();

        if (!name || !email || !password) {
          showError("Semua field wajib diisi");
          return;
        }
        if (!email.includes("@")) {
          showError("Format email tidak valid");
          return;
        }
        if (password.length < 6) {
          showError("Password minimal 6 karakter");
          return;
        }

        registerBtn.disabled = true;
        registerBtn.innerHTML =
          '<i class="fas fa-spinner animate-spin"></i> Memproses...';
        errEl.classList.add("hidden");

        try {
          const result = await registerUser({
            name,
            email,
            password,
            role,
            kelas: kelas || undefined,
          });
          notify("âœ“ Daftar berhasil! Silakan login", "success");
          setTimeout(() => {
            window.location.href = "./login.html";
          }, 800);
        } catch (err) {
          showError(err.message || "Daftar gagal");
        } finally {
          registerBtn.disabled = false;
          registerBtn.innerHTML =
            '<i class="fas fa-user-check mr-2"></i> Daftar Sekarang';
        }
      });

      function showError(message) {
        errText.textContent = message;
        errEl.classList.remove("hidden");
      }
    </script>
  </body>
</html>
